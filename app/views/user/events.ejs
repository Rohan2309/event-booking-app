<!DOCTYPE html>
<html lang="en">
<head>
  <title>Browse Events – EventBook</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f5f6fa;
    }
    .page-title {
      font-weight: 700;
      margin-bottom: 25px;
    }
    .event-card {
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: 0.2s ease-in-out;
      height: 100%;
    }
    .event-card:hover {
      transform: translateY(-4px);
    }
    .event-img {
      width: 100%;
      height: 180px;
      border-radius: 10px;
      object-fit: cover;
    }
    .filter-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 25px;
    }
  </style>
</head>

<body>

  <%- include('../partials/header') %>

  <div class="container py-4">

    <h2 class="page-title">Browse Events</h2>

    <!-- FILTER / SEARCH BAR -->
    <div class="filter-box">
      <form method="get" action="/user/events" class="row g-3">

        <!-- Category Filter -->
        <div class="col-md-4">
          <select class="form-select" name="category">
            <option value="all">All Categories</option>
            <% categories.forEach(cat => { %>
              <option value="<%= cat._id %>" <%= selectedCategory == cat._id ? "selected" : "" %>>
                <%= cat.name %>
              </option>
            <% }) %>
          </select>
        </div>

        <!-- Search -->
        <div class="col-md-4">
          <input type="text" class="form-control" name="search" value="<%= searchQuery %>" placeholder="Search events...">
        </div>

        <!-- Sort -->
        <div class="col-md-3">
          <select class="form-select" name="sort">
            <option value="">Sort by Price</option>
            <option value="price_asc" <%= sort === "price_asc" ? "selected" : "" %>>Low to High</option>
            <option value="price_desc" <%= sort === "price_desc" ? "selected" : "" %>>High to Low</option>
          </select>
        </div>

        <!-- Apply Filter -->
        <div class="col-md-1">
          <button class="btn btn-primary w-100">Go</button>
        </div>
      </form>
    </div>

    <!-- EVENTS GRID -->
    <div class="row">
      <% if(events.length === 0) { %>
        <div class="col-12">
          <div class="alert alert-warning text-center">No events found.</div>
        </div>
      <% } %>

      <% events.forEach(ev => { %>
        <div class="col-md-4 mb-4 d-flex">

          <div class="event-card">

            <% if (ev.image) { %>
              <img src="<%= ev.image %>" alt="Event Image" class="event-img">
            <% } %>

            <h5 class="mt-3"><%= ev.title %></h5>

            <p class="text-muted" style="min-height: 60px;">
              <%= ev.description.substring(0, 120) %>...
            </p>

            <p>
              <strong>Price:</strong> ₹<%= ev.price %><br>
              <strong>Category:</strong> <%= ev.category ? ev.category.name : 'N/A' %><br>
              <strong>Date:</strong> <%= new Date(ev.date).toLocaleDateString() %>
            </p>

            <div class="d-flex justify-content-between mt-3">
              <a href="/events/<%= ev.slug %>" class="btn btn-outline-primary btn-sm">View</a>

              <form action="/user/book/<%= ev._id %>" method="POST">
                <button class="btn btn-success btn-sm">Book Now</button>
              </form>
            </div>

          </div>

        </div>
      <% }) %>
    </div>

  </div>

  <%- include('../partials/footer') %>

</body>
</html>
